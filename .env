# Environment Configuration for FlashLoop Arbitrage
# Replace with your actual values before deployment

# === POLYGON CONFIGURATION ===
# RPC URL for Polygon Mainnet
RPC_URL=https://polygon-mainnet.g.alchemy.com/v2/ddPuLdZaALU4iSNb5eLHT

# Private key for deployment and arbitrage execution
# NEVER commit real keys to git - use environment variables or secure key management
PRIVATE_KEY=REDACTED_PLEASE_SET_SECURELY

# Treasury address for profit distribution (40% of profits go here)
TREASURY=0xf3f566e3421A2379DD073D3223f300dD7A209A21

# Target chain (arbitrum, polygon, mainnet)
CHAIN=polygon

# === ARBITRAGE CONFIGURATION ===
# Asset to arbitrage (USDC on Polygon)
ASSET=0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174

# Arbitrage pair tokens
V3_IN=0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174   # USDC
V3_OUT=0x7ceB23fD6bC0adD59E62ac25578270cFf1b9f619  # WETH

# Token decimals (USDC=6, WETH=18)
DECIMALS=6

# Uniswap V3 fee tier (500 = 0.05%, 3000 = 0.3%, 10000 = 1%)
V3_FEE=500

# Minimum profit threshold in basis points (25 = 0.25%)
MIN_EDGE_BPS=25

# DEX Router Addresses (Polygon)
QUOTER=0x61fFE014bA17989E743c5F6cB21bF9697530B21e    # Uniswap V3 QuoterV2
V2_ROUTER=0xa5E0829CaCEd8fFDD4De3c43696c57F7D7A678ff # QuickSwap Router

# === FLASH LOAN PROVIDERS ===
# Aave V3 Pool for flash loans (required for arbitrage execution)
AAVE_POOL=0x794a61358D6845594F94dc1DB02A252b5b4814aD

# Additional flash loan providers for redundancy and optimization
UNISWAP_V3_FLASH=0xE592427A0AEce92De3Edee1F18E0157C05861564  # Uniswap V3 Flash Module
BALANCER_VAULT=0xBA12222222228d8Ba445958a75a0704d566BF2C8     # Balancer Vault (0% fee!)
CURVE_FLASH=0x39D78f11b246ea4A1f68573c3A5B64E83Cff2bCF         # Curve Flash Loans
DYDX_FLASH_MODULE=0x92D6C1e31e14520e676a687F0a93788B716BEff5    # dYdX Flash Loans (limited availability)

# Flash loan provider priority (preferred order, keep as-is unless you change strategy)
FLASH_PROVIDER_PRIORITY=aave,balancer,uniswap,curve,dydx

# Providers confirmed/supported on Polygon (use this to quickly filter unsupported providers)
# NOTE: Some providers (eg. dYdX) may not offer classic instantaneous on-chain flash loans on Polygon
# â€” verify availability before enabling. Keep `FLASH_PROVIDER_SUPPORTED` in sync with on-chain checks.
FLASH_PROVIDER_SUPPORTED=aave,balancer,uniswap,curve

# dYdX availability flag: set to true only if dYdX flash loans are verified on your target chain
FLASH_PROVIDER_DYDX_INCLUDED=false

# === ATOMIC / RECURSIVE LOAN FLAGS ===
# Enable atomic recursive loan orchestration (requires smart contract support in executor)
ATOMIC_RECURSIVE_ENABLED=true

# Max atomic recursion depth (how many nested/recursive loans executed atomically)
ATOMIC_MAX_RECURSION_DEPTH=5

# Gas limit multiplier applied to estimated gas when performing atomic recursive loops
ATOMIC_GAS_LIMIT_MULTIPLIER=1.20

# Safety buffer (bps) to cover flash fees/slippage when chaining loans atomically
RECURSIVE_ATOMIC_FEE_BUFFER_BPS=50

# Contract-level capability flags (keeper should verify these via on-chain calls)
CONTRACT_SUPPORT_REQUIRED=true
CONTRACT_FEATURES_REQUIRED=ATOMIC_FLASH,REENTRANCY_GUARD,PROFIT_REDISTRIBUTION

# === MATHEMATICAL OPTIMIZATION PARAMETERS ===
# Base loan amount calculation: min(max_loan, gas_wallet_balance * leverage_ratio)
BASE_LOAN_AMOUNT_USD=10000

# Leverage ratios for different risk levels
CONSERVATIVE_LEVERAGE_RATIO=2.0   # 2x gas wallet balance
BALANCED_LEVERAGE_RATIO=5.0       # 5x gas wallet balance
AGGRESSIVE_LEVERAGE_RATIO=10.0    # 10x gas wallet balance
WHALE_LEVERAGE_RATIO=25.0         # 25x gas wallet balance

# Gas cost estimation (Polygon average)
AVERAGE_GAS_COST_USD=0.03

# Flash loan fee calculations (basis points)
AAVE_FLASH_FEE_BPS=900      # 0.09%
UNISWAP_FLASH_FEE_BPS=3000  # 0.3%
BALANCER_FLASH_FEE_BPS=0    # 0.0% (free!)
CURVE_FLASH_FEE_BPS=200     # 0.02%

# Minimum profit threshold after all fees: profit > gas_cost + flash_fee + slippage
MIN_PROFIT_THRESHOLD_USD=0.10

# === RECURSIVE LOAN CONFIGURATION ===
# Enable recursive loans (use profits from previous trades as collateral)
ENABLE_RECURSIVE_LOANS=true

# Maximum recursion depth (how many consecutive loans)
MAX_RECURSION_DEPTH=5

# Profit reinvestment ratio (what % of profits to reinvest)
PROFIT_REINVESTMENT_RATIO=0.60  # 60% of profits back to gas wallet

# Compounding frequency (trades per hour)
COMPOUNDING_FREQUENCY=12  # Every 5 minutes

# Recursive loan scaling factor (how much to increase loan size each iteration)
RECURSIVE_SCALING_FACTOR=1.15  # 15% increase per recursion

# Minimum profit carryover (minimum profit to continue recursion)
MIN_CARRYOVER_PROFIT_USD=0.05

# === ADVANCED COMPOUNDING ALGORITHMS ===
# Compounding strategy: linear, exponential, fibonacci
COMPOUNDING_STRATEGY=exponential

# Fibonacci sequence for loan sizing: F(n) = F(n-1) + F(n-2)
FIBONACCI_BASE_RATIO=0.01  # Base ratio for Fibonacci calculations

# Exponential growth rate: loan_n = loan_0 * (1 + growth_rate)^n
EXPONENTIAL_GROWTH_RATE=0.08  # 8% growth per cycle

# Linear scaling: loan_n = loan_0 + (n * scaling_increment)
LINEAR_SCALING_INCREMENT_USD=50

# === RISK-ADJUSTED POSITION SIZING ===
# Kelly Criterion implementation: f = (bp - q) / b
# Where: f = fraction to invest, b = odds, p = win probability, q = loss probability
KELLY_FRACTION_ENABLED=true
KELLY_WIN_PROBABILITY=0.65    # 65% estimated win rate
KELLY_ODDS_RATIO=1.5          # 1.5:1 payoff ratio

# Maximum Kelly fraction (risk management)
MAX_KELLY_FRACTION=0.25       # Maximum 25% of capital per trade

# === PORTFOLIO OPTIMIZATION ===
# Modern Portfolio Theory (MPT) integration
ENABLE_MPT_OPTIMIZATION=true

# Risk-free rate (approximate Polygon staking yield)
RISK_FREE_RATE=0.05  # 5% annual risk-free rate

# Portfolio volatility target
TARGET_PORTFOLIO_VOLATILITY=0.15  # 15% annual volatility target

# Sharpe ratio optimization
TARGET_SHARPE_RATIO_MPT=2.5

# === STOCHASTIC MODELING ===
# Monte Carlo simulation parameters
MONTE_CARLO_SIMULATIONS=10000
MONTE_CARLO_TIME_HORIZON_DAYS=30

# Value at Risk (VaR) calculation
VAR_CONFIDENCE_LEVEL=0.95      # 95% confidence level
VAR_TIME_HORIZON_HOURS=24      # 24-hour VaR

# Expected Shortfall (ES) calculation
ES_CONFIDENCE_LEVEL=0.975      # 97.5% confidence level

# === MACHINE LEARNING PARAMETERS ===
# Enable ML-based predictions
ENABLE_ML_PREDICTIONS=false    # Set to true when ML model is trained

# Prediction confidence threshold
ML_CONFIDENCE_THRESHOLD=0.75

# Model update frequency (hours)
ML_MODEL_UPDATE_FREQUENCY=24

# Feature engineering parameters
PRICE_CHANGE_WINDOW_MINUTES=60
VOLUME_CHANGE_WINDOW_MINUTES=30
LIQUIDITY_CHANGE_WINDOW_MINUTES=15

# === REAL-TIME ADAPTIVE ALGORITHMS ===
# Adaptive profit threshold based on market conditions
ADAPTIVE_PROFIT_THRESHOLD=true

# Market regime detection (bull, bear, sideways)
MARKET_REGIME_DETECTION=true

# Volatility clustering adjustment
VOLATILITY_CLUSTERING=true

# Mean reversion strategy parameters
MEAN_REVERSION_ENABLED=true
MEAN_REVERSION_LOOKBACK_PERIODS=20
MEAN_REVERSION_ENTRY_THRESHOLD=2.0  # Standard deviations

# Momentum strategy parameters
MOMENTUM_ENABLED=true
MOMENTUM_LOOKBACK_PERIODS=14
MOMENTUM_ENTRY_THRESHOLD=1.5

# === COLLATERAL OPTIMIZATION ===
# Gas wallet utilization ratio
GAS_WALLET_UTILIZATION_RATIO=0.80  # Use 80% of gas wallet balance

# Treasury buffer ratio (untouchable portion)
TREASURY_BUFFER_RATIO=0.20  # Keep 20% as buffer

# Dynamic collateral allocation
DYNAMIC_COLLATERAL_ALLOCATION=true

# Collateral rebalancing threshold
COLLATERAL_REBALANCE_THRESHOLD=0.05  # Rebalance if deviation > 5%

# === PERFORMANCE TRACKING ===
# Real-time performance metrics
REAL_TIME_METRICS=true

# Performance attribution analysis
PERFORMANCE_ATTRIBUTION=true

# Risk-adjusted return calculations
RISK_ADJUSTED_RETURNS=true

# Benchmark comparison (vs buy-and-hold)
BENCHMARK_COMPARISON=true
BENCHMARK_ASSET=WETH  # Compare against WETH performance

# === RISK MANAGEMENT EQUATIONS ===
# Maximum drawdown limit: max_loss = gas_wallet_balance * max_drawdown_ratio
MAX_DRAWDOWN_RATIO=0.10  # 10% maximum loss

# Volatility adjustment factor (increases during high volatility)
VOLATILITY_MULTIPLIER=1.5

# Liquidity depth check (minimum pool liquidity required)
MIN_POOL_LIQUIDITY_USD=50000

# Slippage tolerance for price impact
MAX_SLIPPAGE_BPS=500  # 5% maximum slippage

# === COMPOUNDING CALCULATIONS ===
# Daily compounding formula: A = P(1 + r)^n
# Where: A = final amount, P = principal, r = daily return rate, n = compounding periods

# Target daily return rate (conservative estimate)
TARGET_DAILY_RETURN_RATE=0.02  # 2% daily return

# Expected monthly return with daily compounding
# Formula: (1 + daily_rate)^30 - 1
EXPECTED_MONTHLY_RETURN=0.71  # ~71% monthly at 2% daily

# Break-even analysis
# Break-even loan size: loan_amount = gas_cost / (profit_rate - flash_fee_rate)
BREAK_EVEN_LOAN_USD=300  # At $0.03 gas and 0.1% profit rate

# Optimal loan size formula: optimal = min(max_loan, gas_wallet * leverage * (1 - risk_factor))
OPTIMAL_LOAN_MULTIPLIER=8.5

# === PERFORMANCE METRICS ===
# Sharpe ratio target (risk-adjusted returns)
TARGET_SHARPE_RATIO=2.0

# Maximum consecutive losses before emergency stop
MAX_CONSECUTIVE_LOSSES=3

# Profit factor (gross profit / gross loss)
TARGET_PROFIT_FACTOR=3.0

# Win rate target
TARGET_WIN_RATE=0.65  # 65% win rate

# === DYNAMIC ADJUSTMENT ALGORITHMS ===
# Gas price adjustment: increase profit threshold when gas > threshold
GAS_PRICE_THRESHOLD_GWEI=50
HIGH_GAS_MULTIPLIER=1.5

# Market volatility adjustment
VOLATILITY_THRESHOLD=0.05  # 5% price movement triggers adjustment
VOLATILITY_MULTIPLIER=2.0

# Liquidity adjustment
LOW_LIQUIDITY_MULTIPLIER=0.5

# === ADVANCED STRATEGY PARAMETERS ===
# Triangular arbitrage enable
ENABLE_TRIANGULAR_ARBITRAGE=true

# Cross-DEX arbitrage pairs
TRIANGULAR_PAIRS=USDC-WETH-USDT,USDC-WETH-DAI,WETH-WBTC-USDC

# Multi-hop routing
MAX_HOPS=3

# Price impact tolerance
PRICE_IMPACT_LIMIT_BPS=300  # 3% maximum price impact

# === MONITORING & ANALYTICS ===
# Real-time P&L calculation
REAL_TIME_PL=true

# Performance dashboard update frequency (seconds)
DASHBOARD_UPDATE_FREQUENCY=60

# Alert thresholds for different metrics
LOW_PROFIT_ALERT_THRESHOLD=0.05   # Alert if profit < $0.05
HIGH_GAS_ALERT_THRESHOLD=0.10     # Alert if gas > $0.10
LOW_LIQUIDITY_ALERT_THRESHOLD=10000  # Alert if pool liquidity < $10k

# Contract address (after deployment)
EXECUTOR=0x148758aa07456da17f9938BC349174d41e84eaF4

# === TELEGRAM NOTIFICATIONS ===
# Bot token from @BotFather
TELEGRAM_BOT_TOKEN=7535984092:AAGpm3T768oOD78NJd2RA9tDj9SrWpDoGaU

# Your Telegram chat ID for notifications
TELEGRAM_CHAT_ID=971418501

# Notification settings
NOTIFY_SUCCESS_TRADES=true
NOTIFY_DAILY_REPORT=true
NOTIFY_EMERGENCY=true
NOTIFY_ERRORS=true

# === MULTIPLE PROFIT THRESHOLDS ===
# Conservative mode (0.025% = 25 bps)
CONSERVATIVE_MIN_EDGE_BPS=25

# Balanced mode (0.075% = 75 bps)
BALANCED_MIN_EDGE_BPS=75

# Aggressive mode (0.25% = 250 bps)
AGGRESSIVE_MIN_EDGE_BPS=250

# Whale mode (0.5% = 500 bps)
WHALE_MIN_EDGE_BPS=500

# Current active threshold mode (conservative, balanced, aggressive, whale)
ACTIVE_THRESHOLD_MODE=balanced

# === GAS MANAGEMENT ===
# Maximum gas price in gwei (Polygon)
MAX_GAS_PRICE=100

# Gas wallet address (separate from treasury for security)
GAS_WALLET=0xF349Dd20ac0CAa5B018356076e631B244d669389

# Explicit list of gas wallet private keys for multi-signer rotation (comma-separated).
# DO NOT put real private keys here. Use `.env.local` (gitignored) or an external secrets store.
# Example `.env.local` entry:
# GAS_WALLETS=pk1,pk2

# Profit distribution (percentage to treasury)
TREASURY_SHARE_PERCENT=40

# === EMERGENCY CONTROLS ===
# Emergency stop switch
EMERGENCY_STOP=false

# Maximum daily loss limit (in USD)
MAX_DAILY_LOSS=50

# Maximum single trade size (in USD)
MAX_TRADE_SIZE=1000

# === PERFORMANCE MONITORING ===
# Enable detailed logging
ENABLE_DETAILED_LOGGING=true

# Log file path
LOG_FILE_PATH=./logs/arbitrage.log

# Performance tracking
TRACK_PERFORMANCE=true

# Daily P&L tracking
DAILY_PL_TRACKING=true

# === MULTI-TOKEN SUPPORT ===
# Additional token pairs for arbitrage
USDT_ADDRESS=0xc2132D05D31c914a87C6611C10748AEb04B58e8F
DAI_ADDRESS=0x8f3Cf7ad23Cd3CaDbD9735AFf958023239c6A063
WBTC_ADDRESS=0x1BFD67037B42Cf73acF2047067bd4F2C47D9BfD6
WBNB_ADDRESS=0x3BA4c387f786bFEE076A58914F5Bd38d668B42c3

# List of allowed stablecoins (comma-separated). Keeper will refuse to use flash loans or routing that involve addresses not in this list.
STABLECOIN_LIST=0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174,0xc2132D05D31c914a87C6611C10748AEb04B58e8F,0x8f3Cf7ad23Cd3CaDbD9735AFf958023239c6A063

# === STAKING INTEGRATION ===
# Staking contracts for yield optimization
STMATIC_ADDRESS=0x3A58a54C066FdC0f2D55FC9C89F0415C92eBf3C4
MATICX_ADDRESS=0xfa68FB4628DFF1028CFEc22b4162FCcd0d45efb6

# Auto-compounding settings
AUTO_COMPOUND_STMATIC=true
AUTO_COMPOUND_MATICX=true

# === ADVANCED DEX CONFIGURATION ===
# Additional DEX routers
SUSHISWAP_ROUTER=0x1b02dA8Cb0d097eB8D57A175b88c7D8b47997506
SHIBASWAP_ROUTER=0x03f7724180AA6b939894B5Ca4314783B0b36b329

# Curve pool for stablecoin arbitrage
CURVE_POOL=0x445FE580eF8d70FF569aB36e80c647af338db351

# === MONITORING & ALERTS ===
# Health check interval (seconds)
HEALTH_CHECK_INTERVAL=300

# Alert thresholds
LOW_BALANCE_ALERT=10
HIGH_GAS_ALERT=50

# === DEVELOPMENT SETTINGS ===
# Dry run mode (no real transactions)
# Default to true to prevent accidental real transactions; set CONFIRM_REAL=true to confirm live run.
DRY_RUN=true

# Test mode (use testnet)
TEST_MODE=false

# Verbose logging
VERBOSE=true
